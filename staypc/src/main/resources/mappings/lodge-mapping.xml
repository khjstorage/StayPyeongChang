<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="staypc">
	
	<!-- 메인페잊이 -->
	<select id="listMain" resultType="staypc_lodgeDTO">
		SELECT picture, charge, title FROM staypc_lodge 
		where lno > (SELECT MAX(lno)-9 from staypc_lodge)
		order by lno DESC
	</select>
	
	<select id="count" resultType="int">
        SELECT COUNT(*) 
         FROM  staypc_lodge l, staypc_lodge_date d
        <include refid="search"></include>
    </select>
        
	<!-- 페이지 읽기 추가 시작 -->
	<select id="read" resultType="staypc_lodgeDTO">
		SELECT *FROM staypc_lodge WHERE LODGE_CODE=#{lodge_Code}
	</select>
	<!-- 페이지 읽기 추가 끝 -->
	
	
	<!-- 숙소 게시판 기능
	<select id="read" resultType="staypc_lodgeReviewDTO">
		SELECT *FROM staypc_review WHERE LODGE_CODE=#{review_num}
	</select>
	
	<insert id="insert" resultType="staypc_lodgeReviewDTO">
	insert 
	  -->
	
	
    
   <select id="listAll" resultType="staypc_lodgeDTO">
       <include refid="pagingHeader"></include>
        SELECT l.lno, l.title, l.charge, l.picture
        FROM  staypc_lodge l, staypc_lodge_date d
       <include refid="search"></include>
        order by lno DESC
        <include refid="pagingFooter"></include>
    </select>
	
	<sql id="search">
                WHERE num  like '%'||#{num}||'%' and 
                location   like '%'||#{keyword}||'%' and
                l.lno = d.lno  
               and d.available = 'Y'
                <if test="sdate!=''">
                <![CDATA[
                and d.check_in_date <= #{sdate}
                and d.check_out_date >= #{edate}
                
                ]]>
                </if>
    </sql>

    
    <sql id="pagingHeader">
        SELECT * FROM (
           SELECT ROWNUM AS rn, A.* FROM (
    </sql>
    
    <sql id="pagingFooter">
           ) A
        ) WHERE rn BETWEEN #{start} AND #{end}
    </sql> 
	
</mapper>

