<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="staypc">
	
	<!-- 메인페잊이 -->
	<select id="listMain" resultType="staypc_lodgeDTO">
		SELECT lodge_code, image, charge, title FROM staypc_lodge 
		where lodge_code > (SELECT MAX(lodge_code)-9 from staypc_lodge)
		order by lodge_code DESC
	</select>
	
	<select id="count" resultType="int">
        SELECT COUNT(distinct l.lodge_code) 
         FROM  staypc_lodge l, staypc_lodge_book d
        <include refid="search"></include>
    </select>
        
	<!-- 페이지 읽기 추가 시작 -->
	<select id="read" resultType="staypc_lodgeDTO">
		SELECT * FROM staypc_lodge WHERE LODGE_CODE=#{lodge_Code}
	</select>
	<!-- 페이지 읽기 추가 끝 -->

    
   <select id="listAll" resultType="staypc_lodgeDTO">
       <include refid="pagingHeader"></include>
        SELECT DISTINCT l.lodge_code, l.title, l.charge, l.image
        FROM  staypc_lodge l, staypc_lodge_book d
       <include refid="search"></include>
        order by lodge_code DESC
        <include refid="pagingFooter"></include>
    </select>
	
	<sql id="search">
                WHERE max_people  like '%'||#{num}||'%' and 
                location   like '%'||#{keyword}||'%' and
                l.lodge_code = d.lodge_code
               
                <if test="sdate!=''">
                <![CDATA[
                and d.available = 'Y'
                and d.book_date between #{sdate} and TO_DATE(#{edate})-1
                
                ]]>
                </if>
    </sql>

    
    <sql id="pagingHeader">
        SELECT * FROM (
           SELECT ROWNUM AS rn, A.* FROM (
    </sql>
    
    <sql id="pagingFooter">
           ) A
        ) WHERE rn BETWEEN #{start} AND #{end}
    </sql> 
	
</mapper>

